var publickey = `-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: OpenPGP.js v1.2.0
Comment: http://openpgpjs.org

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
KNk=
=xht7
-----END PGP PUBLIC KEY BLOCK-----
`;

function encryptMessage() {
    var options, encrypted, message;

    message = "<div>From: " + document.getElementById('field_4exe1').value + "</div>";
    message += "<div>Email: " + document.getElementById('field_7qk4o').value + "</div><br>";
    message += "<div>" + document.getElementById('field_8hqkx').value + "</div>";

    console.log(message);

    options = {
        data: message,
        publicKeys: openpgp.key.readArmored(publickey).keys,
    };

    openpgp.encrypt(options).then(function(ciphertext) {
        encrypted = ciphertext.data;
        document.getElementById('output').innerHTML = encrypted;
        document.getElementById('output-label').innerHTML = "Encrypted message:";
    });
}

window.onload = function () {
    document.getElementById('field_4exe1').addEventListener("keyup", function (evt) {
        encryptMessage();
    }, false);
    document.getElementById('field_7qk4o').addEventListener("keyup", function (evt) {
        encryptMessage();
    }, false);
    document.getElementById('field_8hqkx').addEventListener("keyup", function (evt) {
        encryptMessage();
    }, false);

    document.getElementById('output').innerHTML = publickey;
};

function selectText(targetId) {
    if (document.selection) {
        var range = document.body.createTextRange();
        range.moveToElementText(document.getElementById(targetId));
        range.select();
    } else if (window.getSelection) {
        var range = document.createRange();
        range.selectNode(document.getElementById(targetId));
        window.getSelection().addRange(range);
    }
}

function reverseEmail(site, addr) {
    var str = site + '@' + addr;
    return str.split("").reverse().join("");
}

function updateEmail(id) {
    var link = document.getElementById(id);

    link.innerHTML = reverseEmail('moc.prawnj', 'semaj');
    link.setAttribute('href', "mailto:" + reverseEmail('moc.prawnj', 'semaj'));
}

window.onscroll = function() {
    updateEmail('email');
}
